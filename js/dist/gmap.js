/*! p5 2016-03-13 */
function initMap(){google.maps.visualRefresh=!0;var a={center:binghamton,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP},b=$("#map-div").get(0);map=new google.maps.Map(b,a),infoWindow=new google.maps.InfoWindow({content:$("#info-window")}),placesService=new google.maps.places.PlacesService(map)}var map,placesService,markerList=[],currentMarker,infoWindow,binghamton={lat:42.088848,lng:-75.969491},error1,error2,pd,fd,getPlaces=function(){var a={location:binghamton,radius:"2000",types:[placeType()]};placesService.nearbySearch(a,setNewPlaces)},setNewPlaces=function(a,b){searchStatus(b),foundPlaces().length>0&&foundPlaces.removeAll(),b==google.maps.places.PlacesServiceStatus.OK&&(foundPlaces(a),addMarkers())},setMarkers=function(){resetMapMarkers(),filter(""),addMarkers()},resetMapMarkers=function(){for(var a=0;a<markerList.length;a++)markerList[a].setMap(null),markerList[a]=null;markerList.length=0},filterMarkers=function(){resetMapMarkers(),addMarkers()},addMarkers=function(){for(var a=0;a<filteredPlaces().length;a++)addMarker(filteredPlaces()[a],a)},addMarker=function(a,b){var c=new google.maps.Marker({place:{location:a.geometry.location,placeId:a.place_id},title:a.name,icon:{url:getMarkerIcon("inactive",b)},animation:google.maps.Animation.DROP,map:map});c.index=markerList.push(c)-1,c.addListener("click",function(){setCurrentMarker(c)})},triggerInfoWindow=function(a){markerList.length>=filteredPlaces().length&&setCurrentMarker(getCurrentMarker(a))},getCurrentMarker=function(a){for(var b=0;b<markerList.length;b++)if(a===markerList[b].getPlace().placeId)return markerList[b]},setCurrentMarker=function(a){currentMarker&&(currentMarker.setIcon({url:getMarkerIcon("inactive",currentMarker.index)}),currentMarker.setAnimation(null)),currentMarker=a,highlightMarker(currentMarker)},highlightMarker=function(a){a.setZIndex(google.maps.Marker.MAX_ZINDEX+1),a.setIcon({url:getMarkerIcon("active",a.index)}),a.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.setAnimation(null),openInfoWindow(a)},1500)},openInfoWindow=function(a){infoWindow.open(map,a),$("#info-window").empty(),$("#info-window").append("<h3 class='load-message'>Loading...</h3>"),placesService.getDetails({placeId:a.getPlace().placeId},function(a,b){b==google.maps.places.PlacesServiceStatus.OK?($(".load-message").remove(),pd=a,displayPlaceInfo.googleDetails=a,displayPlaceInfo.banner(),displayPlaceInfo.reviews()):$("#info-window").append("<h3 class='no-review-message'>Could not load location info.</h3>")})},displayPlaceInfo={googleDetails:null,banner:function(){if($("#info-window").append("<div id='info-banner' class='clearfix'></div>"),"undefined"!=typeof this.googleDetails.photos){console.log(this.googleDetails.photos);var a=this.googleDetails.photos[0].getUrl({maxWidth:100});$("#info-banner").append("<img src='"+a+"' class='image'>")}"undefined"!=typeof this.googleDetails.name&&$("#info-banner").append("<h1>"+this.googleDetails.name+"</h1>"),"undefined"!=typeof this.googleDetails.formatted_address&&$("#info-banner").append("<p>"+this.googleDetails.formatted_address+"</p>"),"undefined"!=typeof this.googleDetails.formatted_phone_number&&$("#info-banner").append("<p>"+this.googleDetails.formatted_phone_number+"</p>")},reviews:function(){$("#info-window").append("<h2>Reviews</h2>"),this.googleReviews(),this.foursquareReviews()},googleReviews:function(){var a=this.googleDetails.reviews;if($("#info-window").append("<h3>Google</h3>"),"undefined"!=typeof a&&a.length>0){$("#info-window").append("<div class='google-reviews'><ul></ul></div>");for(var b=function(){return a.sort(function(a,b){return a.time==b.time?0:a.time>b.time?-1:1})},c=b().length<4?b().length:4,d=0;c>d;d++)if(b()[d].text){var e=b()[d].text;if(b()[d].time)var f=b()[d].time;$(".google-reviews > ul").append("<li>"+e+" ("+formattedDateTime(f)+")</li>")}}else $("#info-window").append("<h3 class='no-review-message'>No reviews found.</h3>")},foursquareReviews:function(){$("#info-window").append("<h3>FourSquare</h3>"),$("#info-window").append("<div id='foursquare-reviews'></div>"),$("#foursquare-reviews").append("<h3 class='load-message'>Loading...</h3>");var a="https://api.foursquare.com/v2/venues/search",b={client_id:"LKOCAAQC2EHG2YHBHPKMX2TAIHXEOXL3U2GQSCHN5542VYJE",client_secret:"QLLAGNKK2QOLH054PMAPYU1PUQQ4G3YNCOU52WBCH3HDKOQJ"},c={ll:this.googleDetails.geometry.location.lat()+", "+this.googleDetails.geometry.location.lng(),query:this.googleDetails.name,intent:"match",v:"20160101",m:"foursquare"};$.extend(c,b);var d=$.getJSON(a,c,function(a){if(a.response.venues.length>0){var c=a.response.venues[0],d="https://api.foursquare.com/v2/venues/"+c.id,e={v:"20160101",m:"foursquare"};$.extend(e,b);var f=$.getJSON(d,e,function(a){if(error2=f,fd=a,a.response.venue.tips.groups.length>0){var b=a.response.venue.tips.groups[0].items;self.displayPlaceInfo.displayFoursquareReviews(b)}else $("#foursquare-reviews").empty(),$("#foursquare-reviews").append("<h3 class='no-review-message'>No reviews found.</h3>")}).error(function(a,b){console.log(a),console.log(b)})}else $("#foursquare-reviews").empty(),$("#foursquare-reviews").append("<h3 class='no-review-message'>No reviews found.</h3>")}).error(function(){return error1=d,console.log("Status1: "+d.status+" ("+d.statusText+")"),!1})},displayFoursquareReviews:function(a){if(console.log(a),$("#foursquare-reviews").empty(),"undefined"!=typeof a&&a.length>0){$("#foursquare-reviews").append("<ul></ul>");var b=function(){return a.sort(function(a,b){return a.createdAt==b.createdAt?0:a.createdAt>b.createdAt?-1:1})};console.log(b());for(var c=b().length<4?b().length:4,d=0;c>d;d++)if(b()[d].text){var e=b()[d].text;if(b()[d].createdAt)var f=b()[d].createdAt;$("#foursquare-reviews > ul").append("<li>"+e+" ("+formattedDateTime(f)+")</li>")}var g="https://ss0.4sqi.net/img/poweredByFoursquare/poweredby-full-color-bf549c16c0ab3e1b04706ab5fcb422f1.png";$("#foursquare-reviews").append("<p style='text-align: right'><img style='max-width: 150px' src='"+g+"'></p>")}else $("#foursquare-reviews").append("<h3 class='no-review-message'>No reviews found.</h3>")}},getYahooWeather=function(){var a="select * from weather.forecast where woeid in (select woeid from geo.places(1) where text = 'Binghamton NY)&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys",b=yahoo+encodeURI(a),c="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%3D2502265&format=json&diagnostics=true&callback=";console.log("good: "+b),console.log("bad:  "+c),$.getJSON(b,function(a){console.log(a),console.log(c)}).error(function(){console.log(c),console.log(data),console.log("FAIL!")})},getYelpData=function(){var a="https://api.yelp.com/v2/search/?",b="ll=42.0964782196554,-75.9702992976657,0.00&limit=1&callback=?",c=a+encodeURI(b),d=a+b;console.log("good: "+c);var e=$.getJSON(d,function(a){console.log(e),console.log(a),console.log(d)}).error(function(){console.log(e),console.log(c),console.log("FAIL!")})},goodYelp=function(){console.log("IT WORKED!!!!!!!")},getMarkerIcon=function(a,b){var c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZ";switch(a){case"active":c="green";break;case"inactive":default:c="pink"}return"img/src/gm-markers/"+c+"_Marker"+d[b]+".png"},formattedDateTime=function(a){var b=new Date(1e3*a),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=b.getFullYear(),e=c[b.getMonth()],f=b.getDate(),g=b.getHours(),h=b.getMinutes();g%=12,g=g?g:12,h=10>h?"0"+h:h;var i=f+" "+e+" "+d;return i};