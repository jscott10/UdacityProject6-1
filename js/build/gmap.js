/*! p4 2016-01-31 */
function initMap(){$contentNode=$("#info-window"),google.maps.visualRefresh=!0,buLatLng=new google.maps.LatLng(buLocation);var a={center:buLatLng,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP},b=$("#map-div").get(0);map=new google.maps.Map(b,a);var c=new google.maps.TrafficLayer;c.setMap(map),infoWindow=new google.maps.InfoWindow({content:$contentNode[0]}),console.log("just after........"),google.maps.event.addListener(infoWindow,"closeclick",function(){replaceDeletedInfoWindowNode()}),placesService=new google.maps.places.PlacesService(map)}console.log("just before........");var map,infoWindow,placesService,currentSearchType=[],buLatLng,markerList=[],infoWindow,$contentNode,buLocation={lat:42.08824,lng:-75.9692},setMarkers=function(){markerList.length>0&&clearMarkers(),replaceDeletedInfoWindowNode(),filter(""),getPlaces()},filterMarkers=function(){markerList.length>0&&clearMarkers(),replaceDeletedInfoWindowNode(),addMarkers2()},clearMarkers=function(){for(var a=0;a<markerList.length;a++)clearMarker(markerList[a]);markerList.length=0},clearMarker=function(a){a.setMap(null),a=null},getPlaces=function(){var a={location:buLatLng,radius:"2000",types:[placeType()]};placesService.nearbySearch(a,buildPlaceList)},buildPlaceList=function(a,b){if(searchStatus(b),foundPlaces().length>0&&foundPlaces.removeAll(),b==google.maps.places.PlacesServiceStatus.OK){for(var c=0;c<a.length;c++)foundPlaces.push(a[c]);addMarkers()}},addMarkers=function(){for(var a=0;a<filteredPlaces().length;a++)!function(a){setTimeout(function(){createMarker(filteredPlaces()[a])},1e3/a)}(a)},addMarkers2=function(){for(var a=0;a<filteredPlaces().length;a++)createMarker(filteredPlaces()[a])},createMarker=function(a){var b=new google.maps.Marker({place:{location:a.geometry.location,placeId:a.place_id},title:a.name,map:map});markerList.push(b),b.addListener("click",function(){openInfoWindow(b)})},openInfoWindow=function(a){placesService.getDetails({placeId:a.getPlace().placeId},function(b,c){c==google.maps.places.PlacesServiceStatus.OK&&(selectedPlace(b),getFourSquareVenue(b.geometry.location,b.name),infoWindow.open(map,a))})},triggerInfoWindow=function(a){if(markerList.length>=filteredPlaces().length){infoWindow.close(),replaceDeletedInfoWindowNode();var b=getMarker(a,markerList);$("#mypanel").panel("close"),b.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){b.setAnimation(null),openInfoWindow(b)},2e3)}},getMarker=function(a,b){console.log(a),console.log(b);for(var c=0;c<b.length;c++)if(a===b[c].getPlace().placeId)return console.log(b[c]),b[c]},getFourSquareVenue=function(a,b){var b=b,a=a,c="https://api.foursquare.com/v2/venues/",d="search?ll="+a.lat()+", "+a.lng(),e="&query="+encodeURI(b),f="&intent=match",g="client_id=LKOCAAQC2EHG2YHBHPKMX2TAIHXEOXL3U2GQSCHN5542VYJE&client_secret=QLLAGNKK2QOLH054PMAPYU1PUQQ4G3YNCOU52WBCH3HDKOQJ&v=20160108",h=c+d+e+f+"&"+g;$.getJSON(h,function(a){if(a.response.venues.length>0){var b=a.response.venues[0].id,d=c+b+"?"+g;$.getJSON(d,function(a){fsVenue(a.response.venue)}).error(function(){fsVenue(!1)})}else fsVenue(!1)}).error(function(){console.log("Status: "+t0.status+" ("+t0.statusText+")")});console.log("leavin the function")},formattedDateTime=function(a){var b=new Date(1e3*a),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=b.getFullYear(),e=c[b.getMonth()],f=b.getDate(),g=b.getHours(),h=b.getMinutes(),i=12>g?"am":"pm";g%=12,g=g?g:12,h=10>h?"0"+h:h;var j=f+" "+e+" "+d+" "+g+":"+h+" "+i;return j},replaceDeletedInfoWindowNode=function(){$("body").append($contentNode)};